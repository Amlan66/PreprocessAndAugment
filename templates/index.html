<!DOCTYPE html>
<html>
<head>
    <title>File Processing App</title>
    <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>File Processing App</h1>
        
        <!-- File Upload Section -->
        <div class="section">
            <h2>Upload File</h2>
            <input type="file" id="fileInput" accept=".txt,.jpg,.jpeg,.mp3">
            <button onclick="uploadFile()">Upload</button>
        </div>

        <!-- Original Content Display -->
        <div class="section">
            <h2>Original Content</h2>
            <div id="originalContent" class="content-box">
                <!-- Will contain text, image, or audio player based on file type -->
            </div>
        </div>

        <!-- Processing Options -->
        <div class="section">
            <h2>Processing Options</h2>
            <div class="options-container">
                <div class="options">
                    <h3>Select Preprocessing Method:</h3>
                    <div class="select-wrapper">
                        <select id="preprocessingMethod">
                            <option value="none">No Preprocessing</option>
                            <!-- Text options -->
                            <optgroup label="Text Options" id="textPreprocessOpts">
                                <option value="tokenize">Tokenization</option>
                                <option value="removePunct">Remove Punctuation</option>
                                <option value="addPadding">Add Padding</option>
                            </optgroup>
                            <!-- Image options -->
                            <optgroup label="Image Options" id="imagePreprocessOpts">
                                <option value="resize">Resize Image</option>
                                <option value="normalize">Normalize Image</option>
                            </optgroup>
                            <!-- Audio options -->
                            <optgroup label="Audio Options" id="audioPreprocessOpts">
                                <option value="resample">Resample Audio</option>
                                <option value="mfcc">Extract MFCC Features</option>
                            </optgroup>
                        </select>
                    </div>
                </div>
                <div class="options">
                    <h3>Select Augmentation Method:</h3>
                    <div class="select-wrapper">
                        <select id="augmentationMethod">
                            <option value="none">No Augmentation</option>
                            <!-- Text options -->
                            <optgroup label="Text Options" id="textAugmentOpts">
                                <option value="synonymReplace">Synonym Replacement</option>
                                <option value="randomInsert">Random Word Insertion</option>
                            </optgroup>
                            <!-- Image options -->
                            <optgroup label="Image Options" id="imageAugmentOpts">
                                <option value="horizontal_flip">Horizontal Flip</option>
                                <option value="rotation">Random Rotation</option>
                                <option value="noise">Add Noise</option>
                            </optgroup>
                            <!-- Audio options -->
                            <optgroup label="Audio Options" id="audioAugmentOpts">
                                <option value="time_stretch">Time Stretching</option>
                                <option value="pitch_shift">Pitch Shifting</option>
                                <option value="add_noise">Add Background Noise</option>
                            </optgroup>
                        </select>
                    </div>
                </div>
            </div>
            <button onclick="processContent()" class="process-btn">Process Content</button>
        </div>

        <!-- Results Section -->
        <div class="section results">
            <h2>Results</h2>
            <div class="result-box">
                <h3>Preprocessed Content</h3>
                <div id="processedContent" class="content-box">
                    <!-- Will contain processed content -->
                </div>
            </div>
            <div class="result-box">
                <h3>Augmented Content</h3>
                <div id="augmentedContent" class="content-box">
                    <!-- Will contain augmented content -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentFileType = '';

        function updateOptionsVisibility() {
            const textPreprocessOpts = document.getElementById('textPreprocessOpts');
            const imagePreprocessOpts = document.getElementById('imagePreprocessOpts');
            const audioPreprocessOpts = document.getElementById('audioPreprocessOpts');
            const textAugmentOpts = document.getElementById('textAugmentOpts');
            const imageAugmentOpts = document.getElementById('imageAugmentOpts');
            const audioAugmentOpts = document.getElementById('audioAugmentOpts');

            // Hide all options first
            [textPreprocessOpts, imagePreprocessOpts, audioPreprocessOpts,
             textAugmentOpts, imageAugmentOpts, audioAugmentOpts].forEach(el => {
                if (el) el.style.display = 'none';
            });

            // Show relevant options based on file type
            if (currentFileType === 'text') {
                textPreprocessOpts.style.display = '';
                textAugmentOpts.style.display = '';
            } else if (currentFileType === 'image') {
                imagePreprocessOpts.style.display = '';
                imageAugmentOpts.style.display = '';
            } else if (currentFileType === 'audio') {
                audioPreprocessOpts.style.display = '';
                audioAugmentOpts.style.display = '';
            }
        }

        function displayContent(element, content, fileType) {
            if (fileType === 'text') {
                // Check if content contains HTML tags (for tokenization)
                if (content.includes('<span')) {
                    element.innerHTML = content;  // For tokenized text with colors
                } else {
                    element.textContent = content;  // For plain text
                }
            } else if (fileType === 'image') {
                element.innerHTML = `<img src="${content}" alt="Processed image">`;
            } else if (fileType === 'audio') {
                element.innerHTML = `
                    <audio controls>
                        <source src="${content}" type="audio/wav">
                        Your browser does not support the audio element.
                    </audio>`;
            }
        }

        async function uploadFile() {
            try {
                const fileInput = document.getElementById('fileInput');
                const file = fileInput.files[0];
                if (!file) {
                    alert('Please select a file first');
                    return;
                }

                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                if (data.error) {
                    alert(data.error);
                    return;
                }

                currentFileType = data.file_type;
                updateOptionsVisibility();

                // Display original content
                displayContent(document.getElementById('originalContent'), 
                             data.content, currentFileType);

                // Clear previous results
                document.getElementById('processedContent').innerHTML = '';
                document.getElementById('augmentedContent').innerHTML = '';
            } catch (error) {
                console.error('Error uploading file:', error);
                alert('Error uploading file');
            }
        }

        async function processContent() {
            try {
                if (!currentFileType) {
                    alert('Please upload a file first');
                    return;
                }

                const preprocessMethod = document.getElementById('preprocessingMethod').value;
                const augmentMethod = document.getElementById('augmentationMethod').value;

                await Promise.all([
                    handleProcessing('preprocess', preprocessMethod),
                    handleProcessing('augment', augmentMethod)
                ]);

            } catch (error) {
                console.error('Error processing content:', error);
                alert('Error processing content');
            }
        }

        async function handleProcessing(processingType, method) {
            if (method === 'none') return;

            const formData = new FormData();
            formData.append('content_type', currentFileType);
            formData.append('method', method);
            formData.append('processing_type', processingType);

            const response = await fetch('/process', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();

            const resultDiv = document.getElementById(
                processingType === 'preprocess' ? 'processedContent' : 'augmentedContent'
            );

            displayContent(resultDiv, data.result, currentFileType);
        }
    </script>
</body>
</html> 